From 4088ddaa26d81066209152339448b17878d9e861 Mon Sep 17 00:00:00 2001
From: Violet Purcell <vimproved@inventati.org>
Date: Tue, 16 Jan 2024 12:44:58 -0500
Subject: [PATCH] externals: also check pkgconfig for system zstd

---
 externals/cmake-modules/Findzstd.cmake | 34 ++++++++++++++++++++++++++
 1 file changed, 34 insertions(+)
 create mode 100644 externals/cmake-modules/Findzstd.cmake

diff --git a/externals/cmake-modules/Findzstd.cmake b/externals/cmake-modules/Findzstd.cmake
new file mode 100644
index 000000000..4acf45ac4
--- /dev/null
+++ b/externals/cmake-modules/Findzstd.cmake
@@ -0,0 +1,34 @@
+if(NOT ZSTD_FOUND)
+    pkg_check_modules(ZSTD libzstd)
+
+    if (ZSTD_FOUND)
+	    find_path(ZSTD_INCLUDE_DIR NAMES zstd.h
+                PATHS
+                ${ZSTD_INCLUDE_DIRS}
+                /usr/include
+                /usr/local/include
+            )
+
+        find_library(ZSTD_LIBRARY NAMES zstd
+                PATHS
+                ${ZSTD_LIBRARY_DIRS}
+                /usr/lib
+                /usr/local/lib
+            )
+
+        if (NOT TARGET zstd::libzstd_shared)
+            add_library(zstd::libzstd_shared INTERFACE IMPORTED)
+            set_target_properties(zstd::libzstd_shared PROPERTIES
+                INTERFACE_INCLUDE_DIRECTORIES "${ZSTD_INCLUDE_DIR}"
+                INTERFACE_LINK_LIBRARIES "${ZSTD_LIBRARY}"
+                IMPORTED_LOCATION "${ZSTD_LIBRARY}"
+            )
+        endif()
+    else()
+        message(STATUS "zstd not found via pkg-config, trying CMake...")
+        find_package(zstd)
+    endif()
+
+    find_package_handle_standard_args(zstd REQUIRED_VARS ZSTD_INCLUDE_DIR ZSTD_LIBRARY)
+	
+endif()
-- 
2.43.0

