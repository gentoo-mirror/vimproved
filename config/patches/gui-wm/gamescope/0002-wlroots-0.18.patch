From a62c014a0a9bba872b88c00602eb5503d1ca5f8d Mon Sep 17 00:00:00 2001
From: Simon Ser <contact@emersion.fr>
Date: Fri, 24 Nov 2023 14:11:01 +0100
Subject: [PATCH] Update wlroots to v0.18

---
 src/meson.build  | 2 +-
 src/wlserver.cpp | 5 +++--
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/meson.build b/src/meson.build
index d3dec0d2f..f0d99d531 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -22,7 +22,7 @@ stb_dep = dependency('stb')
 
 wlroots_dep = dependency(
   'wlroots',
-  version: ['>= 0.17.0', '< 0.18.0'],
+  version: ['>= 0.18.0', '< 0.19.0'],
   fallback: ['wlroots', 'wlroots'],
   default_options: ['default_library=static', 'examples=false', 'xwayland=enabled', 'backends=libinput', 'renderers=[]', 'allocators=[]', 'session=enabled'],
 )
diff --git a/src/wlserver.cpp b/src/wlserver.cpp
index 49f96ed62..29713c002 100644
--- a/src/wlserver.cpp
+++ b/src/wlserver.cpp
@@ -1177,7 +1177,8 @@ bool wlsession_init( void ) {
 	if ( BIsNested() )
 		return true;
 
-	wlserver.wlr.session = wlr_session_create( wlserver.display );
+	auto loop = wl_display_get_event_loop( wlserver.display );
+	wlserver.wlr.session = wlr_session_create( loop );
 	if ( wlserver.wlr.session == nullptr )
 	{
 		wl_log.errorf( "Failed to create session" );
@@ -1265,7 +1266,7 @@ gamescope_xwayland_server_t::gamescope_xwayland_server_t(wl_display *display)
 
 	update_output_info();
 
-	wlr_output_create_global(output);
+	wlr_output_create_global(output, wlserver.display);
 }
 
 gamescope_xwayland_server_t::~gamescope_xwayland_server_t()
